{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    {% if user.is_authenticated %}
    <div class="alert alert-success" role="alert">
        <h4 class="alert-heading">Welcome, {{ user.username }}!</h4>
        <p class="mb-0">You are logged in.</p>
    </div>
    {% else %}
    <div class="alert alert-info" role="alert">
        <h4 class="alert-heading">Welcome!</h4>
        <p class="mb-0">Please log in to access your dashboard.</p>
    </div>
    {% endif %}

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Dashboard</h1>
        <a href="{% url 'add_student' %}" class="btn btn-success">Add Student</a>
    </div>

    <!-- Tabs Navigation -->
    <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="students-tab" data-toggle="tab" href="#students" role="tab" aria-controls="students" aria-selected="true">Students</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="homework-tab" data-toggle="tab" href="#homework" role="tab" aria-controls="homework" aria-selected="false">Homework</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="activities-tab" data-toggle="tab" href="#activities" role="tab" aria-controls="activities" aria-selected="false">Activities</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="communications-tab" data-toggle="tab" href="#communications" role="tab" aria-controls="communications" aria-selected="false">Communications</a>
        </li>
    </ul>

    <!-- Tabs Content -->
    <div class="tab-content" id="dashboardTabsContent">
        <!-- Students Tab -->
        <div class="tab-pane fade show active" id="students" role="tabpanel" aria-labelledby="students-tab">
            <h2 class="mt-4">Students</h2>
            <ul class="list-group">
                {% for student in students %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ student.first_name }} {{ student.last_name }}
                        <span>
                            <a href="{% url 'add_grade' student.id %}" class="btn btn-primary btn-sm">Add Grade</a> 
                            <a href="{% url 'generate_report' student.id %}" class="btn btn-secondary btn-sm">Generate Report</a>
                        </span>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Homework Tab -->
        <div class="tab-pane fade" id="homework" role="tabpanel" aria-labelledby="homework-tab">
            <h2 class="mt-4">Homework</h2>
            <ul class="list-group">
                {% for hw in homeworks %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ hw.student.first_name }} {{ hw.student.last_name }} - {{ hw.subject }}: {{ hw.description }} (Due: {{ hw.due_date }})
                        <a href="{% url 'view_homework' hw.id %}" class="btn btn-primary btn-sm">View Homework</a>
                    </li>
                {% endfor %}
            </ul>
            <h3 class="mt-4">Add Homework</h3>
            <form method="post">
                {% csrf_token %}
                {{ homework_form.as_p }}
                <button type="submit" class="btn btn-success">Add Homework</button>
            </form>
        </div>

        <!-- Activities Tab -->
        <div class="tab-pane fade" id="activities" role="tabpanel" aria-labelledby="activities-tab">
            <h2 class="mt-4">Activities</h2>
            <ul class="list-group">
                {% for activity in activities %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ activity.student.first_name }} {{ activity.student.last_name }} - {{ activity.description }} (Date: {{ activity.date }})
                        <a href="{% url 'view_activity' activity.id %}" class="btn btn-primary btn-sm">View Activity</a>
                    </li>
                {% endfor %}
            </ul>
            <h3 class="mt-4">Add Activity</h3>
            <form method="post">
                {% csrf_token %}
                {{ activity_form.as_p }}
                <button type="submit" class="btn btn-success">Add Activity</button>
            </form>
        </div>

        <!-- Communications Tab -->
        <div class="tab-pane fade" id="communications" role="tabpanel" aria-labelledby="communications-tab">
            <h2 class="mt-4">Communications</h2>
            <ul class="list-group">
                {% for comm in communications %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ comm.student.first_name }} {{ comm.student.last_name }} - {{ comm.message }} ({{ comm.date }})
                        <a href="{% url 'view_communication' comm.id %}" class="btn btn-primary btn-sm">View Communication</a>
                    </li>
                {% endfor %}
            </ul>
            <h3 class="mt-4">Add Communication</h3>
            <form method="post">
                {% csrf_token %}
                {{ communication_form.as_p }}
                <button type="submit" class="btn btn-success">Add Communication</button>
            </form>
        </div>
    </div>
</div>

<!-- Include Bootstrap JS for tabs to work -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
{% endblock %}

